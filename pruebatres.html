<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <title>DietApp</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.min.css">

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "",
        authDomain: "",
        databaseURL: "",
        projectId: "",
        storageBucket: "",
        messagingSenderId: "",
        appId: ""
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>
</head>

<script type="text/javascript">

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

async function getFruta()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var frutas = general.doc("frutas");
  var contador = 1;
  const numFruta = getRandomInt(1,52);
  //console.log(numFruta);
  var cadena;

  await frutas.collection("listaFrutas").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numFruta) {
          contador++;
          cadena = `fruta: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getCerealNormal()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var cereales = general.doc("cereales");
  var contador = 1;
  const numCereal = getRandomInt(1,46);
  var cadena;

  await cereales.collection("listaCereales").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numCereal) {
          contador++;
          cadena = `Cereal: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getCerealGrasa()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var cereales = general.doc("cerealesGrasa");
  var contador = 1;
  const numCereal = getRandomInt(1,17);
  var cadena;

  await cereales.collection("listaCereales").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numCereal) {
          contador++;
          cadena = `Cereal: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getAnimalBajaGrasa()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var animalBajaGrasa = general.doc("animalBajaGrasa");
  var contador = 1;
  const numAnimal = getRandomInt(1,63);
  var cadena;

  await animalBajaGrasa.collection("listaAnimal").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numAnimal) {
          contador++;
          cadena = `De origen animal: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getAnimalMuyBajaGrasa()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var animalBajaGrasa = general.doc("animalMuyBajaGrasa");
  var contador = 1;
  const numAnimal = getRandomInt(1,53);
  var cadena;

  await animalBajaGrasa.collection("listaAnimal").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numAnimal) {
          contador++;
          cadena = `De origen animal: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getGrasaMono()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var grasaMonoinsaturada = general.doc("grasaMonoinsaturada");
  var contador = 1;
  const numGrasa = getRandomInt(1,12);
  var cadena;

  await grasaMonoinsaturada.collection("listaGrasa").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numGrasa) {
          contador++;
          cadena = `Lípidos Monoinsaturados: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getGrasaPoli()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var grasaPoli = general.doc("grasaPoliinsaturada");
  var contador = 1;
  const numGrasa = getRandomInt(1,9);
  var cadena;

  await grasaPoli.collection("listaGrasa").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numGrasa) {
          contador++;
          cadena = `Lípidos Poliinsaturados: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getLecheDescremada()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var lecheDesc = general.doc("lecheDescremada");
  var contador = 1;
  const numLeche = getRandomInt(1,6);
  var cadena;

  await lecheDesc.collection("listaLeche").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numLeche) {
          contador++;
          cadena = `Derivado de leche: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getLecheEntera()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var lecheEnt = general.doc("lecheEntera");
  var contador = 1;
  const numLeche = getRandomInt(1,5);
  var cadena;

  await lecheEnt.collection("listaLeche").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numLeche) {
          contador++;
          cadena = `Derivado de leche: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getLeguminosa()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var leguminosas = general.doc("leguminosas");
  var contador = 1;
  const numLeg = getRandomInt(1,9);
  var cadena;

  await leguminosas.collection("listaLeguminosas").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numLeg) {
          contador++;
          cadena = `Leguminosa: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}

async function getVerduras()
{
  var db = firebase.firestore();
  var general = db.collection("ingredientes");
  var verdura = general.doc("verduras");
  var contador = 1;
  const numVerduras = getRandomInt(1,60);
  var cadena;

  await verdura.collection("listaVerduras").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {

        if (contador == numVerduras) {
          contador++;
          cadena = `Verdura: ${doc.id}\t Porción: ${doc.data().porcion}`;

        }
        contador++;

      });
  });

   return cadena;
}


async function getDay(calorias) {

//calorias
//fruta                 60
//cereal                70
//cerealgrasa           115
//anialBajo             55
//animal muy bajo       40
//grasa mono            70
//grasa poli            45
//lecheEntera           150
//leche desc            95
//leguminosas           120
//verdura               25

var cadena = "\n\nDesayuno:\n";
var caloriasTotales = 0;

//para todos.
var fruta1 = await getFruta();
caloriasTotales += 60;
cadena += fruta1;
cadena += "\n";

var veggie1 = await getVerduras();
caloriasTotales += 25;
cadena += veggie1;
cadena += "\n";
var cereal1 = await getCerealNormal();
caloriasTotales += 70;
cadena += cereal1;
cadena += "\n";
var grasa1 = await getGrasaMono();
caloriasTotales += 70;
cadena += grasa1;
cadena += "\n";

if (calorias > 1200) {
  var cereal2 = await getCerealNormal();
  caloriasTotales += 70;
  cadena += cereal2;
  cadena += "\n";

  if (calorias > 1400) {
    var animal1 = await getAnimalMuyBajaGrasa();
    caloriasTotales += 40;
    cadena += animal1;
    cadena += "\n";

    if (calorias > 1600) {
      var veggie2 = await getVerduras();
      caloriasTotales += 25;
      cadena += veggie2;
      cadena += "\n";

      if (calorias > 1800) {
        var fruta2 =  await getFruta();
        caloriasTotales += 60;
        cadena += fruta2;
        cadena += "\n";

        if (calorias > 2000) {
          var animal2 = await getAnimalMuyBajaGrasa();
          caloriasTotales += 40;
          cadena += animal2;
          cadena += "\n";

        }
      }
    }
  }
}

cadena += "\n\nColación de medio día\n";

if (calorias > 1200) {
  var cerealCol1 = await getCerealNormal();
  caloriasTotales += 70;
  cadena += cerealCol1;
  cadena += "\n";

  if (calorias < 1600) {
    var lecheCol1 = await getLecheDescremada();
    caloriasTotales += 95;
  }

  if (calorias > 1400) {
    var animalCol1 = await getAnimalMuyBajaGrasa();
    caloriasTotales += 40;
    cadena += animalCol1;
    cadena += "\n";

      if (calorias > 1800) {
        var frutaCol2 = await getFruta();
        caloriasTotales += 60;
        cadena += frutaCol2;
        cadena += "\n";

        if (calorias > 2000) {
          var veggieCol1 = await getVerduras();
          caloriasTotales += 25;
          cadena += veggieCol1;
          cadena += "\n";

          var veggieCol2 = await getVerduras();
          caloriasTotales += 25;
          cadena += veggieCol2;
          cadena += "\n";

        }
      }
  }
}

cadena += "\n\nComida\n"
//todos
  var cerealComida1 = await getCerealNormal();
  caloriasTotales += 70;
  cadena += cerealComida1;
  cadena += "\n";

  var leguminosa1 = await getLeguminosa();
  caloriasTotales += 120;
  cadena += leguminosa1;
  cadena += "\n"

  var veggieComida1 = await getVerduras();
  caloriasTotales += 25;
  cadena += veggieComida1;
  cadena += "\n";

  var veggieComida2 = await getVerduras();
  caloriasTotales += 25;
  cadena += veggieComida2;
  cadena += "\n";

  var frutaComida1 = await getFruta();
  caloriasTotales += 60;
  cadena += frutaComida1;
  cadena += "\n";

  var animalComida1 = await getAnimalMuyBajaGrasa();
  caloriasTotales += 40;
  cadena += animalComida1;
  cadena += "\n";

  var grasaComida1 = await getGrasaPoli();
  caloriasTotales += 45;
  cadena += grasaComida1;
  cadena += "\n";

  var lecheComida1 = await getLecheDescremada();
  caloriasTotales += 95;
  cadena += lecheComida1;
  cadena += "\n";

if (calorias > 1200) {
    var animalComida2 = await getAnimalMuyBajaGrasa();
    caloriasTotales += 40;
    cadena += animalComida2;
    cadena += "\n";

      if (calorias > 1800) {
        var cerealComida3 = await getCerealGrasa();
        caloriasTotales += 115;
        cadena += cerealComida3;
        cadena += "\n";
      }
}

cadena += "\n\nColación de media tarde\n";
//todos

var lecheTarde1 = await getLecheDescremada();
caloriasTotales += 95;
cadena += lecheTarde1;
cadena += "\n";

if (calorias < 1400) {
  if (calorias > 1200) {

    var veggieTarde = await getVerduras();
    caloriasTotales += 25;
    cadena += veggieTarde;
    cadena += "\n";
  }
}

if (calorias > 1400) {

  var cerealTarde1 = await getCerealNormal();
  caloriasTotales += 70;
  cadena += cerealTarde1;
  cadena += "\n";
}

cadena += "\n\nCena\n"
//todos
var cerealCena1 = await getCerealNormal();
caloriasTotales += 70;
cadena += cerealCena1;
cadena += "\n";

var veggieCena1 = await getVerduras();
caloriasTotales += 25;
cadena += veggieCena1;
cadena += "\n";

var frutaCena1 =  await getFruta();
caloriasTotales += 60;
cadena += frutaCena1;
cadena += "\n";

if (calorias > 1200) {

  var lecheCena1 = await getLecheDescremada();
  caloriasTotales += 95;
  cadena += lecheCena1;
  cadena += "\n";
  if (calorias > 1400) {

    var animalCena1 = await getAnimalBajaGrasa();
    caloriasTotales += 55;
    cadena += animalCena1;
    cadena += "\n";
  }
}

//console.log(`calorias totales hasta ahora: ${caloriasTotales}`);
//console.log(`calorias necesarias: ${calorias}`);
var diferencia = (calorias - caloriasTotales);
//console.log(`diferencia: ${diferencia}`);

if (diferencia > 0) {
  cadena += "\nAgregar durante cualquier parte del día:\n\n";

  while (diferencia > 115) {
    var leguminosa2 = await getLeguminosa();
    caloriasTotales += 120;
    cadena += leguminosa2;
    cadena += "\n"

    diferencia = (calorias - caloriasTotales);
  }
  //console.log(`nueva diferencia: ${diferencia}`);
}

console.log("\n\ndieta:");
console.log(cadena);
}

async function mainDieta(){
    const peso = document.getElementById("peso").value;
    const altura = document.getElementById("altura").value;
    const edad = document.getElementById("edad").value;
    const ejercicio = document.getElementById("ejercicio").value;
    var multiplicadorEjercicio = 1.2;

    /// niveles de ejercicio                            Kcla/dia para mantener el peso
    ///
    ///poco ejercicio -> menos de 1 vez a la semana -> BMR x 1.2
    ///ejercicio ligero -> 1 a 3 días a la semana   -> BMR x 1.375
    ///ejercicio moderado -> 3 a 5 días a la semana -> BMR x 1.55
    ///ejercicio pesado -> 6 a 7 días a la semana   -> BMR x 1.725
    ///ejercicio muy pesado -> 2 o más veces al día -> BMR x 1.9
    ///
    /// para bajar de peso, quitar 500 Kcal por cada 0.5Kg, por semana

    if (ejercicio < 4  && ejercicio >= 1) {
      multiplicadorEjercicio = 1.375
      console.log(multiplicadorEjercicio);
    }

    if (ejercicio == 4 || ejercicio == 5) {
      multiplicadorEjercicio = 1.55
      console.log(multiplicadorEjercicio);
    }

    if (ejercicio > 5) {
      multiplicadorEjercicio = 1.725
      console.log(multiplicadorEjercicio);
    }

    console.log(`peso = ${peso} altura = ${altura} edad = ${edad}`);

    /// calcular BMR
    /// hombres -> 88.4 + (13.4 * peso en kg) + (4.8 * altura en cm.) - (5.7 x edad en años)
    /// mujeres -> 447.6 + (9.2 * peso en kg) + (3.1 * altura en cm.) - (4.3 x edad en años)
    ///

    const BMR = (88.4 + (13.4 * peso) + (4.8 * altura) - (5.7 * edad))
    const BMRFem = (447.6 + (9.2 * peso) + (3.1 * altura) - (4.3 * edad))

    const cantidadCalorias = BMR * multiplicadorEjercicio;
    const cantidadCaloriasFem = BMRFem * multiplicadorEjercicio;

    const caloriasBajarPeso = cantidadCalorias - 500;
    const caloriasBajarPesoFem = cantidadCaloriasFem - 500;

    console.log(`Tasa metabólica basal = ${BMR} `);
    console.log(`Tasa metabólica basal femenina = ${BMRFem} `);

    console.log(`Calorias para mantener el peso: ${cantidadCalorias}`);
    console.log(`Calorias para mantener el peso Fem: ${cantidadCaloriasFem}`);

    console.log(`Cantidad de calorias para bajar 500 gramos en una semana: ${caloriasBajarPeso}`);
    console.log(`Cantidad de calorias para bajar 500 gramos en una semana fem: ${caloriasBajarPesoFem}`);

     //getDay(cantidadCalorias); ///para mantener el peso

     console.log("\n\n\n Dieta para bajar de peso:\n\n");
     getDay(caloriasBajarPeso);

/// muestra de get Ingredientes.
    // var fruta1 = await getFruta();
    // console.log(fruta1);
    //
    // var cereal1 = await getCerealNormal();
    // console.log(cereal1);
    //
    // var cerealG = await getCerealGrasa();
    // console.log(cerealG);
    //
    // var animalBG = await getAnimalBajaGrasa();
    // console.log(animalBG);
    //
    // var animalMBG = await getAnimalMuyBajaGrasa();
    // console.log(animalMBG);
    //
    // var grasaMono1 = await getGrasaMono();
    // console.log(grasaMono1);
    //
    // var grasaPoli1 = await getGrasaPoli();
    // console.log(grasaPoli1);
    //
    // var lecheD = await getLecheDescremada();
    // console.log(lecheD);
    //
    // var lecheE = await getLecheEntera();
    // console.log(lecheE);
    //
    // var legum = await getLeguminosa();
    // console.log(legum);
    //
    // var veggie = await getVerduras();
    // console.log(veggie);
    //


  }

</script>

<style type="text/css">
  .login-dark {
  height: 1000px;
  background: #475d62 url(../../assets/img/star-sky.jpg);
  background-size: cover;
  position: relative;
  }

  .login-dark form {
    max-width: 320px;
    width: 90%;
    background-color: #1e2833;
    padding: 40px;
    border-radius: 4px;
    color: #fff;
    box-shadow: 3px 3px 4px rgba(0,0,0,0.2);
  }

  .login-dark .illustration {
    text-align: center;
    padding: 15px 0 20px;
    font-size: 100px;
    color: #2980ef;
  }

  .login-dark form .form-control {
    background: none;
    border: none;
    border-bottom: 1px solid #434a52;
    border-radius: 0;
    box-shadow: none;
    outline: none;
    color: inherit;
  }

  .login-dark form .btn-primary {
    background: #214a80;
    border: none;
    border-radius: 4px;
    padding: 11px;
    box-shadow: none;
    margin-top: 26px;
    text-shadow: none;
    outline: none;
  }

  .login-dark form .btn-primary:hover, .login-dark form .btn-primary:active {
    background: #214a80;
    outline: none;
  }

  .login-dark form .forgot {
    display: block;
    text-align: center;
    font-size: 12px;
    color: #6f7a85;
    opacity: 0.9;
    text-decoration: none;
  }

  .login-dark form .forgot:hover, .login-dark form .forgot:active {
    opacity: 1;
    text-decoration: none;
  }

  .login-dark form .btn-primary:active {
    transform: translateY(1px);
  }
</style>

<body>
  <center>
    <div class="login-dark" style="background-image: url(&quot;assets/img/foodBackground.jpg&quot;);">
        <form method="post" style="height: 550px;">
            <h2 class="sr-only">Login Form</h2>
            <div class="illustration"><img src="assets/img/logo.png"></div>
              <ons-input placeholder="Ingrese su peso" input-id="peso" modifier="underbar"  style="background-color: white; color: black" float></ons-input>
              <br>
              <br>
              <ons-input placeholder="Ingrese su altura en cm" input-id="altura" modifier="underbar"  style="background-color: white; color: black" float></ons-input>
              <br>
              <br>
              <ons-input placeholder="Ingrese su edad en años" input-id="edad" modifier="underbar" style="background-color: white; color: black" float></ons-input>
              <br>
              <br>
              <ons-input placeholder="Días de ejercicio semanales" input-id="ejercicio" modifier="underbar" style="background-color: white; color: black" float></ons-input>
              <br>
              <br>
              <ons-button id="push-button" onclick="mainDieta()" style="background-color: #FFA101; color: white" >obtener dieta</ons-button>
              <br>
              <br>
              <!-- <ons-button id="push-button-F" onclick="logIn()" style="background-color: #FFA101; color: white" >Iniciar Seción</ons-button> -->
          </form>
      </div>
    </center>
    <script type="text/javascript" src="cordova.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>
